drop database manutencao;

Create DATABASE manutencao;

Use manutencao;

CREATE TABLE Cep (
    cep VARCHAR(8) PRIMARY KEY
);

CREATE TABLE endereco (
    idEndereco INT UNSIGNED PRIMARY KEY AUTO_INCREMENT,
    cep VARCHAR(8) NOT NULL,
    numero INT NOT NULL,
    ativo BOOLEAN DEFAULT TRUE,
    FOREIGN KEY (cep)
        REFERENCES Cep (cep)
);

CREATE TABLE cliente (
    idCliente INT UNSIGNED PRIMARY KEY AUTO_INCREMENT,
    cpf VARCHAR(11) NOT NULL UNIQUE,
    nome VARCHAR(64) NOT NULL,
    email VARCHAR(128) NOT NULL UNIQUE,
    idEndereco INT UNSIGNED,
    telefone VARCHAR(13) NOT NULL,
    senha VARCHAR(4) NOT NULL,
    ativo BOOLEAN DEFAULT TRUE,
    FOREIGN KEY (idEndereco)
        REFERENCES endereco (idEndereco)
);

CREATE TABLE categoria (
    idCategoria INT UNSIGNED PRIMARY KEY AUTO_INCREMENT,
    ativo BOOLEAN DEFAULT TRUE,
    nome VARCHAR(64) NOT NULL
);

CREATE TABLE funcionario (
    idFuncionario INT UNSIGNED PRIMARY KEY AUTO_INCREMENT,
    nome VARCHAR(64) NOT NULL,
    email VARCHAR(128) NOT NULL UNIQUE,
    dataNasc DATE NOT NULL,
    telefone VARCHAR(13) NOT NULL,
    ativo BOOLEAN DEFAULT TRUE,
    senha VARCHAR(4) NOT NULL
);

CREATE TABLE stat (
    idStatus INT UNSIGNED PRIMARY KEY AUTO_INCREMENT,
    status VARCHAR(15) NOT NULL
);

CREATE TABLE solicitacao (
    idSolicitacao INT UNSIGNED PRIMARY KEY AUTO_INCREMENT,
    nome VARCHAR(64) NOT NULL,
    descricao VARCHAR(255) NOT NULL,
    idCliente INT UNSIGNED,
    valor DECIMAL(10 , 2 ),
    idStatus INT UNSIGNED NOT NULL,
    idCategoria INT UNSIGNED UNSIGNED NOT NULL,
    ativo BOOLEAN DEFAULT TRUE,
    FOREIGN KEY (idCategoria)
        REFERENCES categoria (idCategoria),
    FOREIGN KEY (idStatus)
        REFERENCES stat (idStatus),
    FOREIGN KEY (idCliente)
        REFERENCES cliente (idCliente)
);

CREATE TABLE HistSolicitacao (
    idHistorico INT UNSIGNED PRIMARY KEY AUTO_INCREMENT,
    dataHora TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    idSolicitacao INT UNSIGNED NOT NULL,
    cliente BOOLEAN,
    statusOld VARCHAR(32),
    statusNew VARCHAR(32),
    funcionarioOld INT UNSIGNED,
    funcionarioNew INT UNSIGNED,
    FOREIGN KEY (idSolicitacao)
        REFERENCES solicitacao (idSolicitacao),
    FOREIGN KEY (funcionarioNew)
        REFERENCES funcionario (idFuncionario),
    FOREIGN KEY (funcionarioOld)
        REFERENCES funcionario (idFuncionario)
);