<div class="p-6 w-full max-w-2xl">
  <!-- Cabeçalho -->
  <h2 class="text-2xl font-semibold mb-4 text-gray-800">
    Detalhes da Solicitação
  </h2>

  <!-- Dados principais -->
  <div class="grid grid-cols-2 gap-4 mb-6">
    <p><span class="font-semibold">ID:</span> {{ data.user.id }}</p>
    <p><span class="font-semibold">Cliente:</span> {{ data.user.requesterName }}</p>
    <p class="col-span-2">
      <span class="font-semibold">Descrição:</span> {{ data.user.description }}
    </p>
    <p><span class="font-semibold">Data de Abertura:</span> {{ data.user.createdAt | date: 'short' }}</p>
    <p><span class="font-semibold">Estado Atual:</span> {{ data.user.state }}</p>
    <p class="col-span-2">
      <span class="font-semibold">Destino:</span>
      {{ data.user.redirectDestinationName || '-' }}
    </p>
  </div>

  <!-- Histórico -->
  <div class="mb-6">
    <h3 class="text-lg font-semibold mb-2">Histórico</h3>
    <ul
      *ngIf="data.user.history?.length; else semHistorico"
      class="space-y-1 text-sm text-gray-700"
    >
      <li *ngFor="let step of data.user.history" class="border-b pb-1">
        <span class="font-semibold">{{ step.date | date: 'short' }}</span> —
        <span class="text-blue-600">{{ step.state }}</span>
        ({{ step.by }})
        <span *ngIf="step.note"> — {{ step.note }}</span>
      </li>
    </ul>
    <ng-template #semHistorico>
      <p class="text-sm text-gray-500">Nenhum histórico disponível.</p>
    </ng-template>
  </div>

  <!-- Ações -->
  <div class="space-y-4">
    <!-- Orçamento -->
    <div *ngIf="data.user.state === 'ABERTA'" class="flex gap-2">
      <button
        (click)="efetuarOrcamento()"
        class="px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded"
      >
        Efetuar Orçamento
      </button>
    </div>

    <!-- Aprovar/Rejeitar -->
    <div *ngIf="data.user.state === 'ORÇADA'" class="space-y-2">
      <p><strong>Orçamento:</strong> R$ {{ data.user.budget }}</p>
      <div class="flex gap-2">
        <button
          (click)="aprovar()"
          class="px-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded"
        >
          Aprovar
        </button>
        <button
          (click)="rejeitar()"
          class="px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded"
        >
          Rejeitar
        </button>
      </div>
    </div>

    <!-- Manutenção -->
    <div
      *ngIf="data.user.state === 'APROVADA' || data.user.state === 'REDIRECIONADA'"
      class="space-y-2"
    >
      <textarea
        [(ngModel)]="descricaoManutencao"
        placeholder="Descrição da manutenção"
        class="w-full p-2 border rounded"
      ></textarea>
      <textarea
        [(ngModel)]="orientacoesCliente"
        placeholder="Orientações para o cliente"
        class="w-full p-2 border rounded"
      ></textarea>
      <div class="flex gap-2">
        <button
          (click)="registrarManutencao()"
          class="px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded"
        >
          Efetuar Manutenção
        </button>
        <button
          (click)="redirecionar()"
          class="px-4 py-2 bg-yellow-500 hover:bg-yellow-600 text-white rounded"
        >
          Redirecionar
        </button>
      </div>
    </div>

    <!-- Pagamento -->
    <div *ngIf="data.user.state === 'ARRUMADA'" class="space-y-2">
      <p><strong>Valor:</strong> R$ {{ data.user.budget }}</p>
      <button
        (click)="pagar()"
        class="px-4 py-2 bg-orange-500 hover:bg-orange-600 text-white rounded"
      >
        Confirmar Pagamento
      </button>
    </div>

    <!-- Finalizar -->
    <div *ngIf="data.user.state === 'PAGA'">
      <button
        (click)="finalizar()"
        class="px-4 py-2 bg-indigo-500 hover:bg-indigo-600 text-white rounded"
      >
        Finalizar
      </button>
    </div>

    <!-- Resgatar -->
    <div *ngIf="data.user.state === 'REJEITADA'">
      <button
        (click)="resgatar()"
        class="px-4 py-2 bg-purple-500 hover:bg-purple-600 text-white rounded"
      >
        Resgatar
      </button>
    </div>
  </div>

  <!-- Fechar -->
  <div class="mt-6 text-right">
    <button
      (click)="close()"
      class="px-4 py-2 bg-gray-400 hover:bg-gray-500 text-white rounded"
    >
      Fechar
    </button>
  </div>
</div>
