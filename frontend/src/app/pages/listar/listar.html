<func-header></func-header>
<div class="container">
  <!-- Controles de filtro -->
  <div
    class="controls flex flex-wrap items-center gap-4"
    aria-label="controles de filtro"
  >
    <label class="flex items-center gap-1 text-gray-700">
      <input
        type="radio"
        name="filtro"
        [(ngModel)]="filtro"
        value="HOJE"
        checked
        class="accent-blue-500"
      />
      Hoje
    </label>
    <label class="flex items-center gap-1 text-gray-700">
      <input
        type="radio"
        name="filtro"
        [(ngModel)]="filtro"
        value="TODAS"
        class="accent-blue-500"
      />
      Todas
    </label>
    <label class="flex items-center gap-1 text-gray-700">
      <input
        type="radio"
        name="filtro"
        [(ngModel)]="filtro"
        value="PERIODO"
        class="accent-blue-500"
      />
      Período
    </label>

    <ng-container *ngIf="filtro === 'PERIODO'">
      <rangeDatePicker class="ml-2"></rangeDatePicker>
    </ng-container>

    <button
      (click)="onRefresh()"
      class="ml-auto bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-md transition"
    >
      Atualizar
    </button>
  </div>

  <!-- Estatísticas rápidas -->
  <div class="stats flex flex-wrap gap-4 text-gray-700">
    <p>
      Total de solicitações:
      <span class="font-semibold">{{ totalSolicitacoes }}</span>
    </p>
    <p>
      Pendentes: <span class="font-semibold">{{ totalPendentes }}</span>
    </p>
    <p>
      Concluídas: <span class="font-semibold">{{ totalConcluidas }}</span>
    </p>
    <p>
      Solicitações de hoje: <span class="font-semibold">{{ totalHoje }}</span>
    </p>
  </div>

  <!-- Filtros extras -->
  <div class="extra-filters flex flex-wrap gap-4">
    <label class="flex flex-col text-gray-700">
      Buscar por cliente:
      <input
        type="text"
        [(ngModel)]="searchClient"
        placeholder="Nome do cliente"
        class="mt-1 p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400"
      />
    </label>
    <label class="flex flex-col text-gray-700">
      Buscar por estado:
      <input
        type="text"
        [(ngModel)]="searchState"
        placeholder="Estado (ex: ORÇADA)"
        class="mt-1 p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400"
      />
    </label>
  </div>
</div>

<!-- Resumo do status da leitura -->
<p class="summary text-gray-600">
  <ng-container *ngIf="loading">Carregando...</ng-container>
  <ng-container *ngIf="!loading && !error">{{ summary }}</ng-container>
  <ng-container *ngIf="error" class="text-red-500 font-semibold">{{
    error
  }}</ng-container>
</p>

<!-- Tabela de solicitações -->
<div class="overflow-x-auto">
  <table class="table-auto w-full border-collapse border border-gray-200">
    <thead class="bg-gray-100 text-left">
      <tr>
        <th class="px-4 py-2 border-b border-gray-200">Data / Hora</th>
        <th class="px-4 py-2 border-b border-gray-200">ID</th>
        <th class="px-4 py-2 border-b border-gray-200">Cliente</th>
        <th class="px-4 py-2 border-b border-gray-200">Descrição</th>
        <th class="px-4 py-2 border-b border-gray-200">Estado</th>
        <th class="px-4 py-2 border-b border-gray-200">Destino</th>
        <th class="px-4 py-2 border-b border-gray-200">Ações</th>
      </tr>
    </thead>
    <tbody class="text-gray-700">
      <tr *ngFor="let s of listaFiltrada" class="hover:bg-gray-50">
        <td class="px-4 py-2">{{ s.createdAt | date : "short" }}</td>
        <td class="px-4 py-2">{{ s.id }}</td>
        <td class="px-4 py-2">{{ s.requesterName || "-" }}</td>
        <td class="px-4 py-2">{{ s.description || "-" }}</td>

        <!-- Estado com badge colorida -->
        <td class="px-4 py-2">
          <span
            class="px-2 py-1 rounded text-xs font-medium"
            [ngClass]="getStatusClass(s.state)"
          >
            {{ s.state }}
          </span>
        </td>

        <td class="px-4 py-2">{{ s.redirectDestinationName || "-" }}</td>

        <!-- Ações -->
        <td class="px-4 py-2">
          <button
            (click)="abrirVisualizar(s)"
            class="bg-blue-500 hover:bg-blue-600 text-white px-2 py-1 rounded text-sm transition"
          >
            Visualizar
          </button>
        </td>
      </tr>

      <!-- Lista vazia -->
      <tr *ngIf="!loading && listaFiltrada.length === 0">
        <td colspan="7" class="text-center py-4 text-gray-500">
          Nenhuma solicitação encontrada.
        </td>
      </tr>
    </tbody>
  </table>
</div>
